# Taskillo - Real-time Todo List Tutorial

**A simple tutorial app demonstrating Cloudillo's real-time database (RTDB).**

Taskillo is a minimalist collaborative todo list that shows you how to build real-time applications with Cloudillo. When one user creates, completes, or deletes a task, all connected users see the change instantly.

## What You'll Learn

- How to initialize a Cloudillo app with `cloudillo.init()`
- How to connect to the real-time database (RTDB)
- How to subscribe to data changes with `onSnapshot()`
- How to perform CRUD operations (create, update, delete)
- How real-time collaboration works automatically

## Quick Start

### Build and Run

```bash
pnpm install
pnpm build
```

### Project Structure

```
apps/taskillo/
├── src/
│   ├── index.tsx              # Entry point (3 lines)
│   ├── app.tsx                # Everything! (hooks + components + main app)
│   ├── types.ts               # Task interface (simple)
│   ├── style.css              # Styling
│   └── index.html             # HTML template
├── package.json
├── tsconfig.json
└── rollup.config.js
```

**That's it!** The entire app logic is in one file (`app.tsx`) for easy learning.

## Key Concepts

### 1. Data Model

The Task interface is intentionally minimal:

```typescript
interface Task {
	id: string // Auto-generated by RTDB
	text: string // Task description
	completed: boolean // Completion status
	createdAt: string // Timestamp
}
```

### 2. Real-time Subscriptions

The core of RTDB is the `onSnapshot()` subscription:

```typescript
// Subscribe to all tasks
const unsubscribe = client.collection('tasks').onSnapshot((snapshot) => {
	// This callback fires whenever ANY task is created, updated, or deleted
	// by ANY user - that's the magic of real-time collaboration!
	const tasks = snapshot.docs.map((doc) => ({
		id: doc.id,
		...doc.data()
	}))
	setTasks(tasks)
})
```

### 3. CRUD Operations

```typescript
// Create
await client.collection('tasks').create({
	text: 'Learn RTDB',
	completed: false,
	createdAt: new Date().toISOString()
})

// Update
await client.ref(`tasks/${id}`).update({ completed: true })

// Delete
await client.ref(`tasks/${id}`).delete()
```

## Code Walkthrough

Everything is in `src/app.tsx` - just open that file and read from top to bottom!

### 1. Initialization (useTaskillo hook in app.tsx)

The initialization hook handles the complete setup:

```typescript
// Parse document ID from URL
const resId = location.hash.slice(1) // #alice:tasks/work
const [, fileId] = resId.split(':') // fileId = "tasks/work"

// Initialize Cloudillo (get auth token from parent shell)
const token = await cloudillo.init('taskillo')

// Create RTDB client
const client = new RtdbClient({
	dbId: fileId,
	auth: { getToken: () => token },
	serverUrl: `wss://${window.location.host}`,
	options: { reconnect: true }
})

// Connect to server
await client.connect()
```

### 2. Data Management (useTasks hook in app.tsx)

Subscribe to changes and expose CRUD operations:

```typescript
// Subscribe to real-time updates
client.collection('tasks').onSnapshot((snapshot) => {
	setTasks(snapshot.docs.map((doc) => ({ id: doc.id, ...doc.data() })))
})

// CRUD operations
const createTask = async (text) => {
	await client.collection('tasks').create({
		text,
		completed: false,
		createdAt: new Date().toISOString()
	})
}

const toggleTask = async (id) => {
	const task = tasks.find((t) => t.id === id)
	await client.ref(`tasks/${id}`).update({ completed: !task.completed })
}

const deleteTask = async (id) => {
	await client.ref(`tasks/${id}`).delete()
}
```

### 3. UI Components (in app.tsx)

Simple React components defined as functions in app.tsx:

- **Header**: Shows connection status and task counts
- **FilterBar**: All/Active/Completed filter buttons
- **TaskInput**: Form to create new tasks
- **TaskList**: Renders list of tasks
- **TaskItem**: Individual task with checkbox and delete button
- **TaskilloApp**: Main component that ties everything together

## Key Takeaways

1. **No manual sync code**: RTDB handles all synchronization automatically
2. **WebSocket connection**: Real-time updates via WebSocket (wss://)
3. **Simple API**: `create()`, `update()`, `delete()` - that's it!
4. **Automatic updates**: `onSnapshot()` fires when ANY client makes changes
5. **Microfrontend pattern**: Apps run in iframes, communicate via postMessage

## Next Steps

- **Read `src/app.tsx`** - The entire app is in one file for easy learning!
- **Try it live**: Open the app in multiple browser tabs to see real-time sync
- **Experiment**: Modify the Task interface in `types.ts` and add new fields
- **Build your own**: Use this as a template for your own collaborative app

## License

LGPL-3.0-or-later
